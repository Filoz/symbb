{% trans_default_domain "symbb_frontend" %}

<div class="symbb_tabcontent" data-tab="files">
    <div class="panel panel-default">
        <div class="padding10">
            <div class="collection" data-prototype='{{ form_widget(form.files.vars.prototype) }}'>
                {% for currfile in form.files %}
                    <div class="collection_item pull-left">
                        {% set imageOriginal = vich_uploader_asset(currfile.vars.data, 'image') %}
                        {% set image = imageOriginal|imagine_filter('symbb_post_file') %}
                        <img src="{{image}}" />
                        <div class="hidden">
                            {{ form_widget(currfile.image) }}
                        </div>
                        <div class="symbb_bbbcode_btn" data-tag-code="[img]{{imageOriginal}}[/img]" title="{{ 'insert file'|trans() }}">
                           <span class="glyphicon glyphicon-picture"  onclick="return false;" title="{{ 'insert file'|trans() }}"></span>
                        </div>
                        <div class="symbb_bbbcode_btn" data-tag-code="" title="{{ 'remove file'|trans() }}">
                           <span class="glyphicon glyphicon-remove-sign collection_item_remove" onclick="return false;" title="{{ 'remove file'|trans() }}"></span>
                        </div>
                        <div class="clear"></div>
                    </div>
                {% endfor %}
                <div class="clear"></div>
                <button class="btn btn-default collection_add" onclick="return false;">{{ 'add file'|trans() }}</button>
                <div class="clear"></div>
             </div>
        </div>
    </div>
</div>

<script>
    
    jQuery(document).ready(function() {
        
        // Get the ul that holds the collection of tags
        $('.collection').each(function(key, collectionHolder){
            console.debug(collectionHolder);
            collectionHolder = $(collectionHolder);
            // count the current form inputs we have (e.g. 2), use that as the new
            // index when inserting a new item (e.g. 2)
            collectionHolder.data('index', collectionHolder.find('.collection_item').length);
            
            var addButton = collectionHolder.find('.collection_add');
            var prototype = collectionHolder.data('prototype');
            
            addButton.on('click', function(e) {
                // prevent the link from creating a "#" on the URL
                e.preventDefault();
                var index = collectionHolder.data('index');
                var newItem = $('<div class="collection_item"></div>');
                var prototypeCurrent = prototype.replace(/__name__/g, index);
                newItem.append($(prototypeCurrent));
                collectionHolder.prepend(newItem);
                collectionHolder.data('index', (index+1));
            });
            
            collectionHolder.find('.collection_item').each(function(key2, item){
                
                item = $(item);
                
                item.find('.collection_item_remove').each(function(key3, btn){
                    
                    $(btn).on('click', function(e) {
                        // prevent the link from creating a "#" on the URL
                        e.preventDefault();
                        item.remove();
                    });
                    
                });
                
            });
            
        });
        
    });
    
</script>