{% trans_default_domain "symbb_frontend" %}

{% extends getSymbbTemplateConfig('forum') ~ ':Forum:layoutWithSidebar.html.twig' %}

{% block symbb_sidebar %}
    
    {% include getSymbbTemplateConfig('forum') ~ ':Forum:sidebar.html.twig' with {'forum': forum} %}
    
{% endblock %}    

{% block symbb_breadcrumb %}
    {{ getSymbbBreadcrumb(forum) }}
{% endblock %}


{% if forum and forum.getType() == 'forum' %}
    {% set topicPagination = getTopicPagination(forum) %}
{% else %}
    {% set topicPagination = false %}
{% endif %}

{% block symbb_body %}

    {% set count = 0 %}
    {% for object in forumList if object.isActive() and object.getType() == 'category' and hasSymbbAccess('SYMBB_FORUM#VIEW', object) %}
        {% set count = count + 1 %}
    {% endfor %}

    {% if count > 0 %}
    <div class="symbb_action_row">
        <div class="title">{{ 'Categories'|trans() }}</div>
        <div class="arrow"></div>
        <div class="clear"></div>
    </div>
    {% endif %}

    {% for object in forumList if object.isActive() and object.getType() == 'category' and hasSymbbAccess('SYMBB_FORUM#VIEW', object) %}
 
        {{ symbBBForumMacro.createCard(object) }}

    {% endfor %}

    {% if count > 0 %}
    <div class="clear spacer-bottom"></div>
    {% endif %}
    
    {% set count = 0 %}
    {% for object in forumList if object.isActive() and object.getType() == 'forum' and hasSymbbAccess('SYMBB_FORUM#VIEW', object) %}
        {% set count = count + 1 %}
    {% endfor %}

    {% if count > 0 %}
    <div class="symbb_action_row">
        <div class="title">{{ 'Forums'|trans() }}</div>
        <div class="arrow"></div>
        <div class="clear"></div>
    </div>
    {% endif %}
    
    
    {% for object in forumList if object.isActive() and object.getType() == 'forum' and hasSymbbAccess('SYMBB_FORUM#VIEW', object) %}
    
        {{ symbBBForumMacro.createCard(object) }}
    
    {% endfor %}
    {% if count > 0 %}
    <div class="clear spacer-bottom"></div>
    {% endif %}
    
    {% if forum and forum.getType() == 'forum' %}
    
        {% set count = 0 %}
        {% for object in forum.getTopics() %}
            {% set count = count + 1 %}
        {% endfor %}

        {% if count > 0 %}
        <div class="symbb_action_row">
            <div class="title">{{ 'Topics'|trans() }}</div>
            <div class="arrow"></div>
            {% if forum and forum.getType() == 'forum' and ( hasSymbbAccess('SYMBB_FORUM#CREATE_TOPIC', forum) or app.user.getSymbbType() == 'user') %}
                <div class="btn-group pull-left">
                    {% if hasSymbbAccess('SYMBB_FORUM#CREATE_TOPIC', forum) %}
                    <button type="button" class="btn btn-default btn-sm" onclick="window.location.href='{{ path('symbb_forum_topic_new', {'forum': forum.getId()}) }}'">{% trans %}new Topic{% endtrans %}</button>
                    {% endif %}
                    {% if app.user.getSymbbType() == 'user' %}
                        <button type="button" class="btn btn-default btn-sm" onclick="window.location.href='{{ path('symbb_forum_read', {'forum': forum.getId()}) }}'">{% trans %}Mark as read{% endtrans %}</button>
                        {% if checkSymbbForForumIgnoreFlag(forum) %}
                            <button title="{{ 'You ignore the forum'|trans }}" type="button" class="btn btn-default btn-sm" onclick="window.location.href='{{ path('symbb_forum_watch', {'forum': forum.getId()}) }}'">
                                <span class="glyphicon glyphicon-eye-close" ></span> {{ 'You ignore the forum'|trans }}
                            </button>
                        {% else %}
                            <button title="{{ 'You watch the forum'|trans }}" type="button" class="btn btn-default btn-sm" onclick="window.location.href='{{ path('symbb_forum_ignore', {'forum': forum.getId()}) }}'">
                                <span class="glyphicon glyphicon glyphicon-eye-open" ></span> {{ 'You watch the forum'|trans }}
                            </button>
                        {% endif %}
                    {% endif %}
                </div>
            {% endif %}
            {{ knp_pagination_render(topicPagination) }}
            <div class="clear"></div>
            </div>
        {% endif %}
        
        {% for object in topicPagination %}
    
            {{ symbBBForumMacro.createTopicCard(object) }}

        {% endfor %}
    
        {{ knp_pagination_render(topicPagination) }}

    {% endif %}
{% endblock %}

